---
const pathname = Astro.url.pathname;
const base = import.meta.env.BASE_URL;

const navigation = [
  { label: 'Accueil', href: `${base}/` },
  { label: 'Le Chœur', href: `${base}/le-choeur` },
  { label: 'Concerts', href: `${base}/concerts` },
  { label: 'Médias', href: `${base}/medias` },
  { label: 'Nous Rejoindre', href: `${base}/nous-rejoindre` },
  { label: 'Contact', href: `${base}/contact` },
];

const isActive = (href: string) => {
  const cleanPath = pathname.replace(/\/$/, '') || '/';
  const cleanHref = href.replace(/\/$/, '') || '/';

  // Pour l'accueil, match exact uniquement
  if (cleanHref === (base || '/')) {
    return cleanPath === (base || '/');
  }

  // Pour les autres pages, match si le path commence par le href
  return cleanPath === cleanHref || cleanPath.startsWith(cleanHref + '/');
};
---

<header class="main-header">
  <nav class="main-header__menu">
    <a class="main-header__logo" href={navigation[0].href} title={navigation[0].label}>
      <img src={`${base}/logo-cassiopee.png`} alt="Logo Cassiopée" />
    </a>
    <button class="main-header__hamburger" aria-label="Ouvrir le menu" aria-expanded="false">
      <span></span>
      <span></span>
      <span></span>
    </button>
    <ul class="main-header__menu-list">
      {navigation.slice(1).map((item) => (
        <li>
          <a
            class={`main-header__menu-link ${isActive(item.href) ? 'active' : ''}`}
            href={item.href}
          >
            {item.label}
          </a>
        </li>
      ))}
    </ul>
  </nav>
</header>

<style>
  .main-header {
    position: relative;
  }

  .main-header__logo {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);

    img {
      display: block;
      height: 9rem;
    }
  }

  .main-header__menu {
    max-width: 1400px;
    margin: 0 auto;
    padding: 5rem 2rem;
  }

  .main-header__menu-list {
    display: flex;
    align-items: center;
    gap: 1.5rem;
    margin: 0;
    padding-left: 0;
    list-style: none;

    & li:nth-child(4) {
      margin-left: auto;
    }
  }

  .main-header__menu-link {
    color: inherit;
    text-decoration: none;

    &::after {
      content: '';
      display: block;
      padding-top: 0.15em;
      border-bottom: 2px dotted currentColor;
    }

    &:hover {
      color: var(--c-orange);
    }

    &.active {
      color: var(--c-orange);
      font-weight: bold;
    }
  }

  .main-header__hamburger {
    position: relative;
    z-index: 1001;
    display: none;
    flex-direction: column;
    justify-content: center;
    gap: 0.375rem;
    width: 2.5rem;
    height: 2.5rem;
    padding: 0.5rem;
    background: none;
    border: none;
    cursor: pointer;

    span {
      display: block;
      width: 1.5rem;
      height: 2px;
      background-color: currentColor;
      transition: all 0.3s ease;
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
    }

    span:nth-child(1) {
      top: calc(50% - 0.6rem);
    }

    span:nth-child(2) {
      top: 50%;
      transform: translateX(-50%) translateY(-50%);
    }

    span:nth-child(3) {
      top: calc(50% + 0.5rem);
    }

    &.active span:nth-child(1) {
      top: 50%;
      transform: translateX(-50%) translateY(-50%) rotate(45deg);
    }

    &.active span:nth-child(2) {
      opacity: 0;
    }

    &.active span:nth-child(3) {
      top: 50%;
      transform: translateX(-50%) translateY(-50%) rotate(-45deg);
    }
  }

  @media (max-width: 980px) {
    .main-header__menu {
      padding: 0.5rem 1rem;
      text-align: center;
    }

    .main-header__logo {
      position: static;
      display: inline-flex;
      margin: 0 auto;
      transform: none;

      img {
        height: 6rem;
      }
    }

    .main-header__hamburger {
      display: flex;
      position: absolute;
      top: 2rem;
      right: 1rem;
    }

    .main-header__menu-list {
      position: fixed;
      top: 0;
      right: 0;
      bottom: 0;
      width: 70%;
      max-width: 300px;
      flex-direction: column;
      align-items: flex-start;
      justify-content: center;
      gap: 2rem;
      padding: 2rem;
      background-color: white;
      box-shadow: -2px 0 10px rgba(0, 0, 0, 0.1);
      transform: translateX(100%);
      transition: transform 0.3s ease;
      z-index: 1000;

      &.open {
        transform: translateX(0);
      }

      & li:nth-child(4) {
        margin-left: 0;
      }
    }
  }
</style>

<script>
  const hamburger = document.querySelector('.main-header__hamburger');
  const menuList = document.querySelector('.main-header__menu-list');

  if (hamburger && menuList) {
    hamburger.addEventListener('click', () => {
      const isOpen = menuList.classList.toggle('open');
      hamburger.classList.toggle('active');
      hamburger.setAttribute('aria-expanded', isOpen.toString());
      hamburger.setAttribute('aria-label', isOpen ? 'Fermer le menu' : 'Ouvrir le menu');
    });

    const menuLinks = menuList.querySelectorAll('.main-header__menu-link');
    menuLinks.forEach((link) => {
      link.addEventListener('click', () => {
        menuList.classList.remove('open');
        hamburger.classList.remove('active');
        hamburger.setAttribute('aria-expanded', 'false');
        hamburger.setAttribute('aria-label', 'Ouvrir le menu');
      });
    });
  }
</script>
